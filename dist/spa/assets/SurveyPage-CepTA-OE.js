import{u as I,f as h,G as k,a1 as w,c as _,o as V,w as f,n as u,a as s,p as c,am as q,s as S,h as N,k as H,l as R,an as Q,Q as x,m as D,a5 as y}from"./index-DwViWMxj.js";import{Q as A}from"./QPage-Cjtquu-L.js";import{u as U}from"./survey-store-BeX5vqfa.js";import{Q as B}from"./QForm-BTrNh0kL.js";import{u as C}from"./settings-store-BZaQpzt_.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"q-mb-md"},P={class:"q-mt-lg"},$={__name:"SurveyForm",props:{initialData:{type:Object,default:null}},emits:["submit"],setup(b,{emit:p}){const r=b,i=C(),o=I(),d={auditDate:new Date().toISOString().substr(0,10),collectorName:"",patientId:"",bedNumber:"",ward:"",hospital:"",isHighRisk:null,user_id:o.userDetails.id},e=h({...d}),v=[{label:"Yes",value:!0},{label:"No",value:!1}];k(()=>r.initialData,l=>{if(l){const t={};for(const a in l)t[a]=l[a];e.value={auditDate:t.auditDate||new Date().toISOString().substr(0,10),collectorName:t.collectorName||"",patientId:t.patientId||"",bedNumber:t.bedNumber||"",ward:t.ward||"",hospital:t.hospital||"",isHighRisk:t.isHighRisk!==void 0?t.isHighRisk:null,user_id:t.user_id||o.userDetails.id,...t}}},{immediate:!0}),w(()=>{if(console.log("user: ",o.userDetails),!r.initialData){i.userSettings.defaultName&&(e.value.collectorName=i.userSettings.defaultName),i.userSettings.defaultHospital&&(e.value.hospital=i.userSettings.defaultHospital),i.userSettings.defaultWard&&(e.value.ward=i.userSettings.defaultWard);const l=localStorage.getItem("collectorName");!e.value.collectorName&&l&&(e.value.collectorName=l)}});const g=p,n=()=>{localStorage.setItem("collectorName",e.value.collectorName),i.userSettings.rememberSettings&&(i.userSettings.defaultName=e.value.collectorName,i.userSettings.defaultHospital=e.value.hospital,i.appSettings.autoSave||i.saveUserSettings()),g("submit",{...e.value})},m=()=>{if(r.initialData){const l={};for(const t in r.initialData)l[t]=r.initialData[t];e.value={auditDate:l.auditDate||new Date().toISOString().substr(0,10),patientId:l.patientId||"",bedNumber:l.bedNumber||"",ward:l.ward||"",hospital:l.hospital||"",isHighRisk:l.isHighRisk!==void 0?l.isHighRisk:null,user_id:o.userDetails.id,...l}}else e.value={...d,auditDate:new Date().toISOString().substr(0,10),collectorName:e.value.collectorName,hospital:e.value.hospital,ward:e.value.ward}};return(l,t)=>(V(),_(B,{onSubmit:n,class:"q-gutter-md"},{default:f(()=>[t[8]||(t[8]=u("div",{class:"text-h6 q-mb-md"},"Patient Medication Audit Form",-1)),s(c,{filled:"",modelValue:e.value.auditDate,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.auditDate=a),label:"Date of Audit *",type:"date",rules:[a=>!!a||"Date is required"]},null,8,["modelValue","rules"]),s(c,{filled:"",modelValue:e.value.collectorName,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.collectorName=a),label:"Data Collector Name *",rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),s(c,{filled:"",modelValue:e.value.patientId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.patientId=a),label:"Patient ID *",rules:[a=>!!a||"Patient ID is required"]},null,8,["modelValue","rules"]),s(c,{filled:"",modelValue:e.value.bedNumber,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.bedNumber=a),label:"Bed Number *",rules:[a=>!!a||"Bed number is required"]},null,8,["modelValue","rules"]),s(c,{filled:"",modelValue:e.value.ward,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.ward=a),label:"Ward *",rules:[a=>!!a||"Ward is required"]},null,8,["modelValue","rules"]),s(c,{filled:"",modelValue:e.value.hospital,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.hospital=a),label:"Hospital *",rules:[a=>!!a||"Hospital is required"]},null,8,["modelValue","rules"]),u("div",O,[t[7]||(t[7]=u("div",{class:"text-subtitle1 q-mb-sm"},"Is the patient on 5 or more regular medications? *",-1)),s(q,{modelValue:e.value.isHighRisk,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.isHighRisk=a),options:v,color:"primary",inline:""},null,8,["modelValue"])]),u("div",P,[s(S,{label:"Submit",type:"submit",color:"primary"}),s(S,{label:"Reset",type:"reset",color:"secondary",flat:"",class:"q-ml-sm",onClick:m})])]),_:1}))}},W=F($,[["__scopeId","data-v-930dc327"]]),E={class:"row justify-center"},j={class:"col-12 col-md-8"},G={class:"text-h5 text-primary q-mb-md"},M={class:"text-subtitle2 q-mb-lg"},X={__name:"SurveyPage",setup(b){const p=H(),r=R(),i=Q(),o=U(),d=N(()=>i.params.id),e=N(()=>!!d.value),v=h(null);w(async()=>{e.value&&(await o.fetchAudits(),v.value=o.getAuditById(d.value),v.value||(p.notify({color:"negative",icon:"error",message:"Audit not found",position:"top",timeout:2e3}),await r.push("/surveys")))});const g=async n=>{console.log("Form submitted:",n);let m;e.value?m=await o.editAudit(d.value,n):m=await o.addAudit(n);const{success:l,error:t}=m;l?p.notify({color:"positive",icon:"check_circle",message:e.value?"Survey data updated successfully":"Survey data saved successfully",position:"top",timeout:2e3}):p.notify({color:"negative",icon:"error",message:`Error ${e.value?"updating":"saving"} data: ${t||"Unknown error"}`,position:"top",timeout:2e3})};return(n,m)=>(V(),_(A,{padding:""},{default:f(()=>[u("div",E,[u("div",j,[s(x,{class:"q-pa-md"},{default:f(()=>[s(D,null,{default:f(()=>[u("div",G,y(e.value?"Edit Patient Audit":"New Patient Audit"),1),u("div",M,y(e.value?"Update the patient medication audit information.":"Complete the form below to record a patient medication audit."),1)]),_:1}),s(D,null,{default:f(()=>[s(W,{onSubmit:g,"initial-data":v.value},null,8,["initial-data"])]),_:1})]),_:1})])])]),_:1}))}};export{X as default};
