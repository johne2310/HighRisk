import{Q as V}from"./QPage-856Hz50I.js";import{a8 as D,k as q,c as f,o as g,w as i,a as s,q as P,m as e,C as b,p as C,D as v,n as A,ar as Q,v as R,A as y,aa as x,as as T,ao as W,a6 as z,f as I,a9 as h}from"./index-CmkbYhrZ.js";import{a as S,b as H,Q as E,d as M,c as B,e as j}from"./export-file-CkdZPzzH.js";import{Q as _}from"./QSkeleton-MLbClfJj.js";import"./QList-D44LAjkH.js";import"./QSelect-CjiheEdO.js";import"./QItem-Ou7gNEGF.js";import"./selection-EChBW4aM.js";import"./rtl-DFPa-2ov.js";const F={class:"text-subtitle2 q-mb-md"},L={class:"full-width row flex-center q-gutter-sm q-pa-lg"},O={class:"row items-center"},G={__name:"HighRiskPatientsByWard",props:{audits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},setup(m){const n=m,l=D(),c=q(()=>n.audits.length?[...new Set(n.audits.map(t=>t.ward))].map(t=>{const a=n.audits.filter(k=>k.ward===t),w=a.filter(k=>k.isHighRisk),d=a.length,u=w.length,$=d>0?Math.round(u/d*100):0,N=a.length>0?a[0].hospital:"";return{ward:t,hospital:N,totalPatients:d,highRiskPatients:u,percentage:$}}).sort((t,a)=>a.percentage-t.percentage):[]),o=()=>{const r=d=>{let u=d!=null?String(d):"";return u=u.replace(/"/g,'""'),(u.includes(",")||u.includes('"')||u.includes(`
`))&&(u=`"${u}"`),u};let a=p.map(d=>r(d.label)).join(",")+`
`;c.value.forEach(d=>{const u=[r(d.hospital),r(d.ward),r(d.totalPatients),r(d.highRiskPatients),r(d.percentage+"%")];a+=u.join(",")+`
`}),j("high_risk_patients_by_ward.csv",a,"text/csv")===!0?l.notify({color:"positive",message:"Ward statistics exported successfully",icon:"file_download"}):l.notify({color:"negative",message:"Export failed - browser denied file download",icon:"error"})},p=[{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"ward",required:!0,label:"Ward",align:"left",field:"ward",sortable:!0},{name:"totalPatients",label:"Total Patients",align:"center",field:"totalPatients",sortable:!0},{name:"highRiskPatients",label:"High Risk Patients",align:"center",field:"highRiskPatients",sortable:!0},{name:"percentage",label:"High Risk %",align:"center",field:"percentage",sortable:!0}];return(r,t)=>(g(),f(R,null,{default:i(()=>[s(P,null,{default:i(()=>[t[2]||(t[2]=e("div",{class:"text-h6"},"High Risk Patients by Ward",-1)),e("div",F,[t[0]||(t[0]=b(" Percentage of high risk patients in each ward ")),s(C,{color:"primary",icon:"file_download",label:"Export to CSV",class:"float-right",onClick:o,disable:!c.value.length||m.loading},null,8,["disable"])]),t[3]||(t[3]=e("br",null,null,-1)),s(S,{title:"Ward Statistics",rows:c.value,columns:p,"row-key":"ward",loading:m.loading,"rows-per-page-options":[10,20,30,50]},{loading:i(()=>[s(B,{showing:""},{default:i(()=>[s(Q,{size:"50px",color:"primary"})]),_:1})]),"no-data":i(()=>[e("div",L,[s(A,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[1]||(t[1]=e("span",{class:"text-h6 text-grey-7"},"No ward data available",-1))])]),"body-cell-percentage":i(a=>[s(H,{props:a},{default:i(()=>[e("div",O,[s(E,{color:a.value>=70?"negative":a.value>=50?"warning":"positive",class:"q-mr-sm"},{default:i(()=>[b(v(a.value)+"% ",1)]),_:2},1032,["color"]),s(M,{value:a.value/100,color:a.value>=70?"negative":a.value>=50?"warning":"positive",style:{width:"100px"},class:"q-ml-sm"},null,8,["value","color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},J={class:"row q-mt-md"},K={class:"col-12 col-md-4"},U={class:"text-h5"},X={class:"col-12 col-md-4"},Y={class:"text-h5"},Z={class:"col-12 col-md-4"},tt={__name:"HighRiskSummaryCard",props:{stats:{type:Object,required:!0,default:()=>({totalAudits:0,highRiskCount:0,highRiskPercentage:0})},loading:{type:Boolean,default:!1}},setup(m){const n=m,l=q(()=>{const c=n.stats.highRiskPercentage;return c>95?"text-green-9":c>75?"text-amber-9":"text-red-9"});return(c,o)=>(g(),f(R,null,{default:i(()=>[s(P,null,{default:i(()=>[o[3]||(o[3]=e("div",{class:"text-h6"},"Summary",-1)),e("div",J,[e("div",K,[o[0]||(o[0]=e("div",{class:"text-subtitle2"},"Total Patients",-1)),e("div",U,[n.loading?(g(),f(_,{key:0,type:"text",width:"50px"})):(g(),y(x,{key:1},[b(v(n.stats.totalAudits),1)],64))])]),e("div",X,[o[1]||(o[1]=e("div",{class:"text-subtitle2"},"High Risk Patients",-1)),e("div",Y,[n.loading?(g(),f(_,{key:0,type:"text",width:"50px"})):(g(),y(x,{key:1},[b(v(n.stats.highRiskCount),1)],64))])]),e("div",Z,[o[2]||(o[2]=e("div",{class:"text-subtitle2"},"Percentage",-1)),e("div",{class:T(["text-h5",l.value])},[n.loading?(g(),f(_,{key:0,type:"text",width:"50px"})):(g(),y(x,{key:1},[b(v(n.stats.highRiskPercentage)+"%",1)],64))],2)])])]),_:1})]),_:1}))}},et={class:"full-width row flex-center q-gutter-sm q-pa-lg"},at={__name:"PatientsOnFivePlusMedications",props:{highRiskAudits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["view-audit"],setup(m,{emit:n}){const l=m,c=n,o=r=>{c("view-audit",r)},p=[{name:"auditDate",required:!0,label:"Date",align:"left",field:r=>r.auditDate,format:r=>`${r}`,sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"collectorName",label:"Audited By",align:"left",field:"collectorName",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(r,t)=>(g(),f(R,null,{default:i(()=>[s(P,null,{default:i(()=>[t[1]||(t[1]=e("div",{class:"text-h6"},"Patients on 5+ Medications",-1)),t[2]||(t[2]=e("div",{class:"text-subtitle2 q-mb-md"}," Patients taking 5 or more regular medications are considered high risk ",-1)),s(S,{title:"High Risk Patients",rows:l.highRiskAudits,columns:p,"row-key":"id",loading:l.loading,"rows-per-page-options":[10,20,30,50]},{loading:i(()=>[s(B,{showing:""},{default:i(()=>[s(Q,{size:"50px",color:"primary"})]),_:1})]),"no-data":i(()=>[e("div",et,[s(A,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[0]||(t[0]=e("span",{class:"text-h6 text-grey-7"}," No high risk patients found ",-1))])]),"body-cell-actions":i(a=>[s(H,{props:a},{default:i(()=>[s(C,{flat:"",round:"",dense:"",color:"primary",icon:"visibility",onClick:w=>o(a.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},gt={__name:"HighRiskPage",setup(m){const n=I(),l=W();z(async()=>{await Promise.all([l.loadAudits(),l.loadHighRiskAudits(),l.fetchStats()])});const c=o=>{n.push(`/surveys/${o}`)};return(o,p)=>(g(),f(V,{padding:""},{default:i(()=>[p[0]||(p[0]=e("div",{class:"text-h4 text-primary q-mb-md"},"High Risk Patients",-1)),s(at,{"high-risk-audits":h(l).highRiskAudits,loading:h(l).loading,onViewAudit:c},null,8,["high-risk-audits","loading"]),s(tt,{class:"q-mt-md",stats:h(l).stats,loading:h(l).loading},null,8,["stats","loading"]),s(G,{class:"q-mt-md",audits:h(l).audits,loading:h(l).loading},null,8,["audits","loading"])]),_:1}))}};export{gt as default};
