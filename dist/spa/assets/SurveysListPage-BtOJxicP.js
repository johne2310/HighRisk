import{Q as I,a as T,b as P,c as R,e as E}from"./export-file-BfWA1p_L.js";import{Q as S}from"./QSelect-BbMv-wr2.js";import{ao as W,j as Q,k as b,a2 as j,c as g,o as p,w as r,f as z,h as L,a7 as M,m as i,a as s,v as V,q as N,a5 as y,a4 as h,a6 as f,p as m,a8 as U,a9 as v,n as Y,ar as O}from"./index-BPZ8F6sc.js";import{Q as G}from"./QPage-AUxN8AhO.js";import"./QList-DmeKTQav.js";import"./QItem-BUDCUJeX.js";import"./selection-CY9uNe4L.js";import"./rtl-DFPa-2ov.js";const J={class:"text-h6"},K={class:"row q-col-gutter-md"},X={class:"col-12 col-md-5"},Z={class:"col-12 col-md-5"},ee={class:"col-12 col-md-3 flex items-center"},te={class:"text-subtitle2 q-mb-md"},le={key:0},ae={class:"full-width row flex-center q-gutter-sm q-pa-lg"},se={class:"text-h6 text-grey-7"},fe={__name:"SurveysListPage",setup(oe){const A=z(),u=W(),{showSuccess:w,showError:C}=L(),B=M(),o=Q(null),n=Q(null),H=b(()=>[...new Set(u.audits.map(e=>e.hospital))].filter(Boolean).sort().map(e=>({label:e,value:e}))),_=b(()=>{let t=[];if(o.value){const e=u.getAuditsByHospital(o.value);t=[...new Set(e.map(l=>l.ward))]}else t=[...new Set(u.audits.map(e=>e.ward))];return t.filter(Boolean).sort().map(e=>({label:e,value:e}))}),c=b(()=>{let t=u.audits;return o.value&&(t=u.getAuditsByHospital(o.value)),n.value&&(t=t.filter(e=>e.ward===n.value)),t}),k=()=>{o.value=null,n.value=null};j(async()=>{});const D=()=>{const t=a=>{let d=a!=null?String(a):"";return d=d.replace(/"/g,'""'),(d.includes(",")||d.includes('"')||d.includes(`
`))&&(d=`"${d}"`),d};let l=x.filter(a=>a.name!=="actions").map(a=>t(a.label)).join(",")+`
`;c.value.forEach(a=>{const d=[t(a.auditDate),t(a.collectorName),t(a.patientId),t(a.bedNumber),t(a.ward),t(a.hospital),t(a.isHighRisk?"Yes":"No")];l+=d.join(",")+`
`}),E("patient_medication_audits.csv",l,"text/csv")===!0?w():C("There was an error exporting the CSV file")},F=t=>{A.push(`/surveys/${t}`)},$=t=>{B.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete the audit for patient ${t.patientId}?`,cancel:!0,persistent:!0}).onOk(async()=>{const{success:e,error:l}=await u.deleteAudit(t.id);e?w("Audit deleted successfully"):C(l.message)})},x=[{name:"auditDate",required:!0,label:"Date",align:"left",field:t=>t.auditDate,format:t=>`${t}`,sortable:!0},{name:"collectorName",required:!0,label:"Collector",align:"left",field:"collectorName",sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"isHighRisk",label:"High Risk",align:"center",field:"isHighRisk",format:t=>t?"Yes":"No",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(t,e)=>(p(),g(G,{padding:""},{default:r(()=>[e[8]||(e[8]=i("div",{class:"text-h4 text-primary q-mb-md"},"Patient Audits",-1)),s(V,{class:"q-mb-md"},{default:r(()=>[s(N,null,{default:r(()=>[i("div",J,[e[3]||(e[3]=y(" Filters ")),o.value||n.value?(p(),g(I,{key:0,color:"primary",class:"q-ml-sm"},{default:r(()=>[y(f((o.value?1:0)+(n.value?1:0))+" active ",1)]),_:1})):h("",!0)]),e[4]||(e[4]=i("div",{class:"text-subtitle2 q-mb-md"},"Filter audits by hospital or ward",-1)),i("div",K,[i("div",X,[s(S,{filled:"",modelValue:o.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.value=l),e[1]||(e[1]=l=>n.value=null)],options:H.value,label:"Filter by Hospital",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),i("div",Z,[s(S,{filled:"",modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value=l),options:_.value,label:"Filter by Ward",clearable:"","emit-value":"","map-options":"",disable:!_.value.length},null,8,["modelValue","options","disable"])]),i("div",ee,[s(m,{color:"secondary",label:"Clear Filters",onClick:k,disable:!o.value&&!n.value,class:"q-mt-sm"},null,8,["disable"])])])]),_:1})]),_:1}),s(V,null,{default:r(()=>[s(N,null,{default:r(()=>[e[6]||(e[6]=i("div",{class:"text-h6"},"All Audits",-1)),i("div",te,[e[5]||(e[5]=y(" View and manage patient medication audits ")),c.value.length!==v(u).audits.length?(p(),U("span",le," (Showing "+f(c.value.length)+" of "+f(v(u).audits.length)+" records) ",1)):h("",!0),s(m,{color:"primary",icon:"file_download",label:"Export to CSV",class:"float-right",onClick:D,disable:!c.value.length||v(u).loading},null,8,["disable"])]),e[7]||(e[7]=i("br",null,null,-1)),s(T,{title:"Patient Medication Audits",rows:c.value,columns:x,"row-key":"id",loading:v(u).loading,"rows-per-page-options":[10,20,30,50]},{loading:r(()=>[s(R,{showing:""},{default:r(()=>[s(O,{size:"50px",color:"primary"})]),_:1})]),"no-data":r(()=>[i("div",ae,[s(Y,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),i("span",se,f(o.value||n.value?"No audit data matches the current filters":"No audit data available yet"),1),o.value||n.value?(p(),g(m,{key:0,color:"primary",label:"Clear Filters",onClick:k,class:"q-mt-sm"})):h("",!0)])]),"body-cell-actions":r(l=>[s(P,{props:l},{default:r(()=>[s(m,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:q=>F(l.row.id)},null,8,["onClick"]),s(m,{flat:"",round:"",dense:"",color:"negative",icon:"delete",onClick:q=>$(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1}))}};export{fe as default};
