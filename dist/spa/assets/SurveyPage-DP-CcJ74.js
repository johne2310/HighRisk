import{r as D,w as h,H as w,W as V,X as _,Y as f,a3 as d,_ as i,ad as c,ae as I,a4 as g,a as S,aa as q,af as k,ab as H,ac as N,a1 as y}from"./index-B_VpsIxP.js";import{Q as x}from"./QPage-Ra_pWBhx.js";import{u as Q}from"./use-quasar-C8yzo686.js";import{u as R}from"./survey-store-DVfqfPxj.js";import{Q as U}from"./QForm-B8axG8Z2.js";import{u as A}from"./settings-store-DgfgHM-f.js";import"./index-DjiOMwEi.js";const O=(p,n)=>{const s=p.__vccOpts||p;for(const[o,u]of n)s[o]=u;return s},B={class:"q-mb-md"},C={class:"q-mt-lg"},F={__name:"SurveyForm",props:{initialData:{type:Object,default:null}},emits:["submit"],setup(p,{emit:n}){const s=p,o=A(),u={auditDate:new Date().toISOString().substr(0,10),collectorName:"",patientId:"",bedNumber:"",ward:"",hospital:"",isHighRisk:null},t=D({...u}),r=[{label:"Yes",value:!0},{label:"No",value:!1}];h(()=>s.initialData,l=>{if(l){const e={};for(const a in l)e[a]=l[a];t.value={auditDate:e.auditDate||new Date().toISOString().substr(0,10),collectorName:e.collectorName||"",patientId:e.patientId||"",bedNumber:e.bedNumber||"",ward:e.ward||"",hospital:e.hospital||"",isHighRisk:e.isHighRisk!==void 0?e.isHighRisk:null,...e}}},{immediate:!0}),w(()=>{if(!s.initialData){o.userSettings.defaultName&&(t.value.collectorName=o.userSettings.defaultName),o.userSettings.defaultHospital&&(t.value.hospital=o.userSettings.defaultHospital),o.userSettings.defaultWard&&(t.value.ward=o.userSettings.defaultWard);const l=localStorage.getItem("collectorName");!t.value.collectorName&&l&&(t.value.collectorName=l)}});const v=n,b=()=>{localStorage.setItem("collectorName",t.value.collectorName),o.userSettings.rememberSettings&&(o.userSettings.defaultName=t.value.collectorName,o.userSettings.defaultHospital=t.value.hospital,o.appSettings.autoSave||o.saveUserSettings()),v("submit",{...t.value})},m=()=>{if(s.initialData){const l={};for(const e in s.initialData)l[e]=s.initialData[e];t.value={auditDate:l.auditDate||new Date().toISOString().substr(0,10),patientId:l.patientId||"",bedNumber:l.bedNumber||"",ward:l.ward||"",hospital:l.hospital||"",...l}}else t.value={...u,auditDate:new Date().toISOString().substr(0,10),collectorName:t.value.collectorName,hospital:t.value.hospital,ward:t.value.ward}};return(l,e)=>(_(),V(U,{onSubmit:b,class:"q-gutter-md"},{default:f(()=>[e[8]||(e[8]=d("div",{class:"text-h6 q-mb-md"},"Patient Medication Audit Form",-1)),i(c,{filled:"",modelValue:t.value.auditDate,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.auditDate=a),label:"Date of Audit *",type:"date",rules:[a=>!!a||"Date is required"]},null,8,["modelValue","rules"]),i(c,{filled:"",modelValue:t.value.collectorName,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.collectorName=a),label:"Data Collector Name *",rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),i(c,{filled:"",modelValue:t.value.patientId,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.patientId=a),label:"Patient ID *",rules:[a=>!!a||"Patient ID is required"]},null,8,["modelValue","rules"]),i(c,{filled:"",modelValue:t.value.bedNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.bedNumber=a),label:"Bed Number *",rules:[a=>!!a||"Bed number is required"]},null,8,["modelValue","rules"]),i(c,{filled:"",modelValue:t.value.ward,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.ward=a),label:"Ward *",rules:[a=>!!a||"Ward is required"]},null,8,["modelValue","rules"]),i(c,{filled:"",modelValue:t.value.hospital,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.hospital=a),label:"Hospital *",rules:[a=>!!a||"Hospital is required"]},null,8,["modelValue","rules"]),d("div",B,[e[7]||(e[7]=d("div",{class:"text-subtitle1 q-mb-sm"},"Is the patient on 5 or more regular medications? *",-1)),i(I,{modelValue:t.value.isHighRisk,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.isHighRisk=a),options:r,color:"primary",inline:""},null,8,["modelValue"])]),d("div",C,[i(g,{label:"Submit",type:"submit",color:"primary"}),i(g,{label:"Reset",type:"reset",color:"secondary",flat:"",class:"q-ml-sm",onClick:m})])]),_:1}))}},P=O(F,[["__scopeId","data-v-82d17f25"]]),$={class:"row justify-center"},W={class:"col-12 col-md-8"},E={class:"text-h5 text-primary q-mb-md"},j={class:"text-subtitle2 q-mb-lg"},L={__name:"SurveyPage",setup(p){const n=Q(),s=q(),o=k(),u=R(),t=S(()=>o.params.id),r=S(()=>!!t.value),v=D(null);w(async()=>{r.value&&(await u.fetchAudits(),v.value=u.getAuditById(t.value),v.value||(n.notify({color:"negative",icon:"error",message:"Audit not found",position:"top",timeout:2e3}),s.push("/surveys")))});const b=async m=>{console.log("Form submitted:",m);let l;r.value?l=await u.editAudit(t.value,m):l=await u.addAudit(m);const{success:e,error:a}=l;e?n.notify({color:"positive",icon:"check_circle",message:r.value?"Survey data updated successfully":"Survey data saved successfully",position:"top",timeout:2e3}):n.notify({color:"negative",icon:"error",message:`Error ${r.value?"updating":"saving"} data: ${a||"Unknown error"}`,position:"top",timeout:3e3})};return(m,l)=>(_(),V(x,{padding:""},{default:f(()=>[d("div",$,[d("div",W,[i(H,{class:"q-pa-md"},{default:f(()=>[i(N,null,{default:f(()=>[d("div",E,y(r.value?"Edit Patient Audit":"New Patient Audit"),1),d("div",j,y(r.value?"Update the patient medication audit information.":"Complete the form below to record a patient medication audit."),1)]),_:1}),i(N,null,{default:f(()=>[i(P,{onSubmit:b,"initial-data":v.value},null,8,["initial-data"])]),_:1})]),_:1})])])]),_:1}))}};export{L as default};
