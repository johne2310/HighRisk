import{Q as N}from"./QPage-C_43vpqa.js";import{h as V,c as p,o as c,w as i,a as s,j as P,k as e,a1 as b,n as q,a2 as w,m as Q,am as A,Q as R,a3 as y,a5 as _,_ as D,ai as T,u as W,a4 as h}from"./index-On3-25VC.js";import{u as I}from"./survey-store-CQF-XeHv.js";import{a as S,b as C,Q as j,d as z,c as H,e as E}from"./export-file-dn-ZtBgY.js";import{u as F}from"./use-quasar-CwIxAg5y.js";import{Q as x}from"./QSkeleton-CETXV6DU.js";import"./index-DmcVIg0K.js";import"./QList-BCgNzfMc.js";import"./QSelect-3tguL7EG.js";import"./QItem-CGxf0ePg.js";const M={class:"text-subtitle2 q-mb-md"},L={class:"full-width row flex-center q-gutter-sm q-pa-lg"},O={class:"row items-center"},U={__name:"HighRiskPatientsByWard",props:{audits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},setup(g){const d=g,l=F(),n=V(()=>d.audits.length?[...new Set(d.audits.map(t=>t.ward))].map(t=>{const a=d.audits.filter(k=>k.ward===t),v=a.filter(k=>k.isHighRisk),r=a.length,u=v.length,B=r>0?Math.round(u/r*100):0,$=a.length>0?a[0].hospital:"";return{ward:t,hospital:$,totalPatients:r,highRiskPatients:u,percentage:B}}).sort((t,a)=>a.percentage-t.percentage):[]),f=()=>{const o=r=>{let u=r!=null?String(r):"";return u=u.replace(/"/g,'""'),(u.includes(",")||u.includes('"')||u.includes(`
`))&&(u=`"${u}"`),u};let a=m.map(r=>o(r.label)).join(",")+`
`;n.value.forEach(r=>{const u=[o(r.hospital),o(r.ward),o(r.totalPatients),o(r.highRiskPatients),o(r.percentage+"%")];a+=u.join(",")+`
`}),E("high_risk_patients_by_ward.csv",a,"text/csv")===!0?l.notify({color:"positive",message:"Ward statistics exported successfully",icon:"file_download"}):l.notify({color:"negative",message:"Export failed - browser denied file download",icon:"error"})},m=[{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"ward",required:!0,label:"Ward",align:"left",field:"ward",sortable:!0},{name:"totalPatients",label:"Total Patients",align:"center",field:"totalPatients",sortable:!0},{name:"highRiskPatients",label:"High Risk Patients",align:"center",field:"highRiskPatients",sortable:!0},{name:"percentage",label:"High Risk %",align:"center",field:"percentage",sortable:!0}];return(o,t)=>(c(),p(R,null,{default:i(()=>[s(P,null,{default:i(()=>[t[2]||(t[2]=e("div",{class:"text-h6"},"High Risk Patients by Ward",-1)),e("div",M,[t[0]||(t[0]=b(" Percentage of high risk patients in each ward ")),s(q,{color:"primary",icon:"file_download",label:"Export to CSV",class:"float-right",onClick:f,disable:!n.value.length||g.loading},null,8,["disable"])]),t[3]||(t[3]=e("br",null,null,-1)),s(S,{title:"Ward Statistics",rows:n.value,columns:m,"row-key":"ward",loading:g.loading,"rows-per-page-options":[10,20,30,50]},{loading:i(()=>[s(H,{showing:""},{default:i(()=>[s(A,{size:"50px",color:"primary"})]),_:1})]),"no-data":i(()=>[e("div",L,[s(Q,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[1]||(t[1]=e("span",{class:"text-h6 text-grey-7"},"No ward data available",-1))])]),"body-cell-percentage":i(a=>[s(C,{props:a},{default:i(()=>[e("div",O,[s(j,{color:a.value>=70?"negative":a.value>=50?"warning":"positive",class:"q-mr-sm"},{default:i(()=>[b(w(a.value)+"% ",1)]),_:2},1032,["color"]),s(z,{value:a.value/100,color:a.value>=70?"negative":a.value>=50?"warning":"positive",style:{width:"100px"},class:"q-ml-sm"},null,8,["value","color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},G={class:"row q-mt-md"},J={class:"col-12 col-md-4"},K={class:"text-h5"},X={class:"col-12 col-md-4"},Y={class:"text-h5"},Z={class:"col-12 col-md-4"},tt={class:"text-h5"},et={__name:"HighRiskSummaryCard",props:{stats:{type:Object,required:!0,default:()=>({totalAudits:0,highRiskCount:0,highRiskPercentage:0})},loading:{type:Boolean,default:!1}},setup(g){const d=g;return(l,n)=>(c(),p(R,null,{default:i(()=>[s(P,null,{default:i(()=>[n[3]||(n[3]=e("div",{class:"text-h6"},"Summary",-1)),e("div",G,[e("div",J,[n[0]||(n[0]=e("div",{class:"text-subtitle2"},"Total Patients",-1)),e("div",K,[d.loading?(c(),p(x,{key:0,type:"text",width:"50px"})):(c(),y(_,{key:1},[b(w(d.stats.totalAudits),1)],64))])]),e("div",X,[n[1]||(n[1]=e("div",{class:"text-subtitle2"},"High Risk Patients",-1)),e("div",Y,[d.loading?(c(),p(x,{key:0,type:"text",width:"50px"})):(c(),y(_,{key:1},[b(w(d.stats.highRiskCount),1)],64))])]),e("div",Z,[n[2]||(n[2]=e("div",{class:"text-subtitle2"},"Percentage",-1)),e("div",tt,[d.loading?(c(),p(x,{key:0,type:"text",width:"50px"})):(c(),y(_,{key:1},[b(w(d.stats.highRiskPercentage)+"%",1)],64))])])])]),_:1})]),_:1}))}},at={class:"full-width row flex-center q-gutter-sm q-pa-lg"},st={__name:"PatientsOnFivePlusMedications",props:{highRiskAudits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["view-audit"],setup(g,{emit:d}){const l=g,n=d,f=o=>{n("view-audit",o)},m=[{name:"auditDate",required:!0,label:"Date",align:"left",field:o=>o.auditDate,format:o=>`${o}`,sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"collectorName",label:"Audited By",align:"left",field:"collectorName",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(o,t)=>(c(),p(R,null,{default:i(()=>[s(P,null,{default:i(()=>[t[1]||(t[1]=e("div",{class:"text-h6"},"Patients on 5+ Medications",-1)),t[2]||(t[2]=e("div",{class:"text-subtitle2 q-mb-md"}," Patients taking 5 or more regular medications are considered high risk ",-1)),s(S,{title:"High Risk Patients",rows:l.highRiskAudits,columns:m,"row-key":"id",loading:l.loading,"rows-per-page-options":[10,20,30,50]},{loading:i(()=>[s(H,{showing:""},{default:i(()=>[s(A,{size:"50px",color:"primary"})]),_:1})]),"no-data":i(()=>[e("div",at,[s(Q,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[0]||(t[0]=e("span",{class:"text-h6 text-grey-7"}," No high risk patients found ",-1))])]),"body-cell-actions":i(a=>[s(C,{props:a},{default:i(()=>[s(q,{flat:"",round:"",dense:"",color:"primary",icon:"visibility",onClick:v=>f(a.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},pt={__name:"HighRiskPage",setup(g){const d=W(),l=I();D(async()=>{await Promise.all([l.fetchAudits(),l.fetchHighRiskAudits(),l.fetchStats()])}),T(()=>{l.unsubscribeFromRealtimeUpdates()});const n=f=>{d.push(`/surveys/${f}`)};return(f,m)=>(c(),p(N,{padding:""},{default:i(()=>[m[0]||(m[0]=e("div",{class:"text-h4 text-primary q-mb-md"},"High Risk Patients",-1)),s(st,{"high-risk-audits":h(l).highRiskAudits,loading:h(l).loading,onViewAudit:n},null,8,["high-risk-audits","loading"]),s(et,{class:"q-mt-md",stats:h(l).stats,loading:h(l).loading},null,8,["stats","loading"]),s(U,{class:"q-mt-md",audits:h(l).audits,loading:h(l).loading},null,8,["audits","loading"])]),_:1}))}};export{pt as default};
