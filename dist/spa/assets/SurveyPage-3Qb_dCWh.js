import{u as H,j as _,H as I,a2 as w,c as V,o as q,w as f,m as o,a as i,Q as p,ap as R,p as N,ao as A,k as h,h as x,f as Q,aq as F,v as U,q as D,a6 as y}from"./index-BPZ8F6sc.js";import{Q as C}from"./QPage-AUxN8AhO.js";import{Q as B}from"./QForm-X2jWU_sz.js";import{u as P}from"./settings-store-BArSOewM.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"q-mb-md"},j={class:"q-mt-lg"},E={__name:"SurveyForm",props:{initialData:{type:Object,default:null}},emits:["submit"],setup(S,{emit:g}){const u=S,s=P(),r=H(),n=()=>{const l=new Date,e=l.getFullYear(),a=String(l.getMonth()+1).padStart(2,"0"),k=String(l.getDate()).padStart(2,"0");return`${e}-${a}-${k}`},d={auditDate:n(),collectorName:"",patientId:"",bedNumber:"",ward:"",hospital:"",isHighRisk:null,user_id:r.userDetails.id},t=_({...d}),v=[{label:"Yes",value:!0},{label:"No",value:!1}];I(()=>u.initialData,l=>{if(l){const e={};for(const a in l)e[a]=l[a];t.value={auditDate:e.auditDate||n(),collectorName:e.collectorName||"",patientId:e.patientId||"",bedNumber:e.bedNumber||"",ward:e.ward||"",hospital:e.hospital||"",isHighRisk:e.isHighRisk!==void 0?e.isHighRisk:null,user_id:e.user_id||r.userDetails.id,...e}}else t.value={...d}},{immediate:!0}),w(()=>{if(console.log("user: ",r.userDetails),!u.initialData){s.userSettings.defaultName&&(t.value.collectorName=s.userSettings.defaultName),s.userSettings.defaultHospital&&(t.value.hospital=s.userSettings.defaultHospital),s.userSettings.defaultWard&&(t.value.ward=s.userSettings.defaultWard);const l=localStorage.getItem("collectorName");!t.value.collectorName&&l&&(t.value.collectorName=l)}});const b=g,m=()=>{localStorage.setItem("collectorName",t.value.collectorName),s.userSettings.rememberSettings&&(s.userSettings.defaultName=t.value.collectorName,s.userSettings.defaultHospital=t.value.hospital,s.appSettings.autoSave||s.saveUserSettings()),b("submit",{...t.value})},c=()=>{if(u.initialData){const l={};for(const e in u.initialData)l[e]=u.initialData[e];t.value={auditDate:l.auditDate||n(),patientId:l.patientId||"",bedNumber:l.bedNumber||"",ward:l.ward||"",hospital:l.hospital||"",isHighRisk:l.isHighRisk!==void 0?l.isHighRisk:null,user_id:r.userDetails.id,...l}}else{const l=t.value?.collectorName||"",e=t.value?.hospital||"",a=t.value?.ward||"";t.value={...d,auditDate:n(),collectorName:l,hospital:e,ward:a}}};return(l,e)=>(q(),V(B,{onSubmit:m,class:"q-gutter-md"},{default:f(()=>[e[8]||(e[8]=o("div",{class:"text-h6 q-mb-md"},"Patient Medication Audit Form",-1)),i(p,{filled:"",modelValue:t.value.auditDate,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.auditDate=a),label:"Date of Audit *",type:"date",rules:[a=>!!a||"Date is required"]},null,8,["modelValue","rules"]),i(p,{filled:"",modelValue:t.value.collectorName,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.collectorName=a),label:"Data Collector Name *",rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),i(p,{filled:"",modelValue:t.value.patientId,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.patientId=a),label:"Patient ID *",rules:[a=>!!a||"Patient ID is required"]},null,8,["modelValue","rules"]),i(p,{filled:"",modelValue:t.value.bedNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.bedNumber=a),label:"Bed Number *",rules:[a=>!!a||"Bed number is required"]},null,8,["modelValue","rules"]),i(p,{filled:"",modelValue:t.value.ward,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.ward=a),label:"Ward *",rules:[a=>!!a||"Ward is required"]},null,8,["modelValue","rules"]),i(p,{filled:"",modelValue:t.value.hospital,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.hospital=a),label:"Hospital *",rules:[a=>!!a||"Hospital is required"]},null,8,["modelValue","rules"]),o("div",W,[e[7]||(e[7]=o("div",{class:"text-subtitle1 q-mb-sm"},"Is the patient on 5 or more regular medications? *",-1)),i(R,{modelValue:t.value.isHighRisk,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.isHighRisk=a),options:v,color:"primary",inline:""},null,8,["modelValue"])]),o("div",j,[i(N,{label:"Submit",type:"submit",color:"primary"}),i(N,{label:"Reset",type:"reset",color:"secondary",flat:"",class:"q-ml-sm",onClick:c})])]),_:1}))}},M=$(E,[["__scopeId","data-v-43607c55"]]),O={class:"row justify-center"},T={class:"col-12 col-md-8"},Y={class:"text-h5 text-primary q-mb-md"},G={class:"text-subtitle2 q-mb-lg"},Z={__name:"SurveyPage",setup(S){const g=Q(),u=F(),s=A(),{showError:r,showSuccess:n}=x(),d=h(()=>u.params.id),t=h(()=>!!d.value),v=_(null);w(async()=>{t.value&&(await s.loadAudits(),v.value=s.getAuditById(d.value),v.value||(r("Audit data not found."),await g.push("/surveys")))});const b=async m=>{console.log("Form submitted:",m);let c;t.value?c=await s.editAudit(d.value,m):c=await s.saveAudit(m);const{success:l,error:e}=c;l?n("Audit saved successfully"):r(e.message)};return(m,c)=>(q(),V(C,{padding:""},{default:f(()=>[o("div",O,[o("div",T,[i(U,{class:"q-pa-md"},{default:f(()=>[i(D,null,{default:f(()=>[o("div",Y,y(t.value?"Edit Patient Audit":"New Patient Audit"),1),o("div",G,y(t.value?"Update the patient medication audit information.":"Complete the form below to record a patient medication audit."),1)]),_:1}),i(D,null,{default:f(()=>[i(M,{onSubmit:b,"initial-data":v.value},null,8,["initial-data"])]),_:1})]),_:1})])])]),_:1}))}};export{Z as default};
