import{Q as N,a as V,b as F,c as $}from"./QTable-6CdMzooX.js";import{Q as h}from"./QSelect-BFmEOxMm.js";import{r as k,a as f,H as D,U as I,W as v,X as u,Y as r,aa as U,a3 as n,_ as l,ab as q,ac as x,a0 as b,Z as g,a1 as d,a4 as c,a6 as P,a5 as y,$ as R,ag as W}from"./index-JtsXV9uc.js";import{Q as T}from"./QPage-Bm9ZzIEO.js";import{u as z}from"./survey-store-DYbmR2Qq.js";import{u as E}from"./use-quasar-M0fi8oDx.js";import"./QList-zvgzyUlf.js";import"./QItem-CXy9yFKX.js";const L={class:"text-h6"},M={class:"row q-col-gutter-md"},Y={class:"col-12 col-md-5"},O={class:"col-12 col-md-5"},X={class:"col-12 col-md-2 flex items-center"},Z={class:"text-subtitle2 q-mb-md"},j={key:0},G={class:"full-width row flex-center q-gutter-sm q-pa-lg"},J={class:"text-h6 text-grey-7"},ne={__name:"SurveysListPage",setup(K){const m=E(),Q=U(),o=z(),a=k(null),i=k(null),A=f(()=>[...new Set(o.audits.map(e=>e.hospital))].filter(Boolean).sort().map(e=>({label:e,value:e}))),w=f(()=>{let t=[];if(a.value){const e=o.getAuditsByHospital(a.value);t=[...new Set(e.map(s=>s.ward))]}else t=[...new Set(o.audits.map(e=>e.ward))];return t.filter(Boolean).sort().map(e=>({label:e,value:e}))}),p=f(()=>{let t=o.audits;return a.value&&(t=o.getAuditsByHospital(a.value)),i.value&&(t=t.filter(e=>e.ward===i.value)),t}),_=()=>{a.value=null,i.value=null};D(async()=>{await o.fetchAudits()}),I(()=>{o.unsubscribeFromRealtimeUpdates()});const C=t=>{Q.push(`/surveys/${t}`)},S=t=>{m.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete the audit for patient ${t.patientId}?`,cancel:!0,persistent:!0}).onOk(async()=>{const{success:e,error:s}=await o.removeAudit(t.id);e?m.notify({color:"positive",icon:"check_circle",message:"Audit deleted successfully",position:"top",timeout:2e3}):m.notify({color:"negative",icon:"error",message:"Error deleting audit: "+(s||"Unknown error"),position:"top",timeout:3e3})})},B=[{name:"auditDate",required:!0,label:"Date",align:"left",field:t=>t.auditDate,format:t=>`${t}`,sortable:!0},{name:"collectorName",required:!0,label:"Collector",align:"left",field:"collectorName",sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"isHighRisk",label:"High Risk",align:"center",field:"isHighRisk",format:t=>t?"Yes":"No",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(t,e)=>(u(),v(T,{padding:""},{default:r(()=>[e[7]||(e[7]=n("div",{class:"text-h4 text-primary q-mb-md"},"Patient Audits",-1)),l(q,{class:"q-mb-md"},{default:r(()=>[l(x,null,{default:r(()=>[n("div",L,[e[3]||(e[3]=b(" Filters ")),a.value||i.value?(u(),v(N,{key:0,color:"primary",class:"q-ml-sm"},{default:r(()=>[b(d((a.value?1:0)+(i.value?1:0))+" active ",1)]),_:1})):g("",!0)]),e[4]||(e[4]=n("div",{class:"text-subtitle2 q-mb-md"},"Filter audits by hospital or ward",-1)),n("div",M,[n("div",Y,[l(h,{filled:"",modelValue:a.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>a.value=s),e[1]||(e[1]=s=>i.value=null)],options:A.value,label:"Filter by Hospital",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",O,[l(h,{filled:"",modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),options:w.value,label:"Filter by Ward",clearable:"","emit-value":"","map-options":"",disable:!w.value.length},null,8,["modelValue","options","disable"])]),n("div",X,[l(c,{color:"secondary",label:"Clear Filters",onClick:_,disable:!a.value&&!i.value,class:"q-mt-sm"},null,8,["disable"])])])]),_:1})]),_:1}),l(q,null,{default:r(()=>[l(x,null,{default:r(()=>[e[6]||(e[6]=n("div",{class:"text-h6"},"All Audits",-1)),n("div",Z,[e[5]||(e[5]=b(" View and manage patient medication audits ")),p.value.length!==y(o).audits.length?(u(),P("span",j," (Showing "+d(p.value.length)+" of "+d(y(o).audits.length)+" records) ",1)):g("",!0)]),l(V,{title:"Patient Medication Audits",rows:p.value,columns:B,"row-key":"id",loading:y(o).loading,"rows-per-page-options":[10,20,30,50]},{loading:r(()=>[l($,{showing:""},{default:r(()=>[l(W,{size:"50px",color:"primary"})]),_:1})]),"no-data":r(()=>[n("div",G,[l(R,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),n("span",J,d(a.value||i.value?"No audit data matches the current filters":"No audit data available yet"),1),a.value||i.value?(u(),v(c,{key:0,color:"primary",label:"Clear Filters",onClick:_,class:"q-mt-sm"})):g("",!0)])]),"body-cell-actions":r(s=>[l(F,{props:s},{default:r(()=>[l(c,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:H=>C(s.row.id)},null,8,["onClick"]),l(c,{flat:"",round:"",dense:"",color:"negative",icon:"delete",onClick:H=>S(s.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1}))}};export{ne as default};
