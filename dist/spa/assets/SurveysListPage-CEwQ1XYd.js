import{Q as F,a as $,b as I,c as R,e as E}from"./export-file-FWy1xBHr.js";import{Q as q}from"./QSelect-CfhWWn8Y.js";import{f as Q,h as g,a1 as P,ak as U,c as y,o as f,w as d,k as T,l as W,n,a as s,Q as A,m as S,a4 as w,a3 as h,a5 as v,s as p,a6 as j,a7 as b,q as z,ao as L}from"./index-DwViWMxj.js";import{Q as M}from"./QPage-Cjtquu-L.js";import{u as Y}from"./survey-store-BeX5vqfa.js";import"./QList-CnS_lqOM.js";import"./QItem-D5ILlyPN.js";const O={class:"text-h6"},G={class:"row q-col-gutter-md"},J={class:"col-12 col-md-5"},K={class:"col-12 col-md-5"},X={class:"col-12 col-md-2 flex items-center"},Z={class:"text-subtitle2 q-mb-md"},ee={key:0},te={class:"full-width row flex-center q-gutter-sm q-pa-lg"},le={class:"text-h6 text-grey-7"},ce={__name:"SurveysListPage",setup(ae){const c=T(),N=W(),o=Y(),i=Q(null),r=Q(null),V=g(()=>[...new Set(o.audits.map(e=>e.hospital))].filter(Boolean).sort().map(e=>({label:e,value:e}))),k=g(()=>{let t=[];if(i.value){const e=o.getAuditsByHospital(i.value);t=[...new Set(e.map(l=>l.ward))]}else t=[...new Set(o.audits.map(e=>e.ward))];return t.filter(Boolean).sort().map(e=>({label:e,value:e}))}),m=g(()=>{let t=o.audits;return i.value&&(t=o.getAuditsByHospital(i.value)),r.value&&(t=t.filter(e=>e.ward===r.value)),t}),_=()=>{i.value=null,r.value=null};P(async()=>{await o.fetchAudits()}),U(()=>{o.unsubscribeFromRealtimeUpdates()});const B=()=>{const t=a=>{let u=a!=null?String(a):"";return u=u.replace(/"/g,'""'),(u.includes(",")||u.includes('"')||u.includes(`
`))&&(u=`"${u}"`),u};let l=x.filter(a=>a.name!=="actions").map(a=>t(a.label)).join(",")+`
`;m.value.forEach(a=>{const u=[t(a.auditDate),t(a.collectorName),t(a.patientId),t(a.bedNumber),t(a.ward),t(a.hospital),t(a.isHighRisk?"Yes":"No")];l+=u.join(",")+`
`}),E("patient_medication_audits.csv",l,"text/csv")===!0?c.notify({color:"positive",message:"Audit data exported successfully",icon:"file_download"}):c.notify({color:"negative",message:"Export failed - browser denied file download",icon:"error"})},H=t=>{N.push(`/surveys/${t}`)},D=t=>{c.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete the audit for patient ${t.patientId}?`,cancel:!0,persistent:!0}).onOk(async()=>{const{success:e,error:l}=await o.removeAudit(t.id);e?c.notify({color:"positive",icon:"check_circle",message:"Audit deleted successfully",position:"top",timeout:2e3}):c.notify({color:"negative",icon:"error",message:"Error deleting audit: "+(l||"Unknown error"),position:"top",timeout:3e3})})},x=[{name:"auditDate",required:!0,label:"Date",align:"left",field:t=>t.auditDate,format:t=>`${t}`,sortable:!0},{name:"collectorName",required:!0,label:"Collector",align:"left",field:"collectorName",sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"isHighRisk",label:"High Risk",align:"center",field:"isHighRisk",format:t=>t?"Yes":"No",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(t,e)=>(f(),y(M,{padding:""},{default:d(()=>[e[8]||(e[8]=n("div",{class:"text-h4 text-primary q-mb-md"},"Patient Audits",-1)),s(A,{class:"q-mb-md"},{default:d(()=>[s(S,null,{default:d(()=>[n("div",O,[e[3]||(e[3]=w(" Filters ")),i.value||r.value?(f(),y(F,{key:0,color:"primary",class:"q-ml-sm"},{default:d(()=>[w(v((i.value?1:0)+(r.value?1:0))+" active ",1)]),_:1})):h("",!0)]),e[4]||(e[4]=n("div",{class:"text-subtitle2 q-mb-md"},"Filter audits by hospital or ward",-1)),n("div",G,[n("div",J,[s(q,{filled:"",modelValue:i.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>i.value=l),e[1]||(e[1]=l=>r.value=null)],options:V.value,label:"Filter by Hospital",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",K,[s(q,{filled:"",modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l),options:k.value,label:"Filter by Ward",clearable:"","emit-value":"","map-options":"",disable:!k.value.length},null,8,["modelValue","options","disable"])]),n("div",X,[s(p,{color:"secondary",label:"Clear Filters",onClick:_,disable:!i.value&&!r.value,class:"q-mt-sm"},null,8,["disable"])])])]),_:1})]),_:1}),s(A,null,{default:d(()=>[s(S,null,{default:d(()=>[e[6]||(e[6]=n("div",{class:"text-h6"},"All Audits",-1)),n("div",Z,[e[5]||(e[5]=w(" View and manage patient medication audits ")),m.value.length!==b(o).audits.length?(f(),j("span",ee," (Showing "+v(m.value.length)+" of "+v(b(o).audits.length)+" records) ",1)):h("",!0),s(p,{color:"primary",icon:"file_download",label:"Export to CSV",class:"float-right",onClick:B,disable:!m.value.length||b(o).loading},null,8,["disable"])]),e[7]||(e[7]=n("br",null,null,-1)),s($,{title:"Patient Medication Audits",rows:m.value,columns:x,"row-key":"id",loading:b(o).loading,"rows-per-page-options":[10,20,30,50]},{loading:d(()=>[s(R,{showing:""},{default:d(()=>[s(L,{size:"50px",color:"primary"})]),_:1})]),"no-data":d(()=>[n("div",te,[s(z,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),n("span",le,v(i.value||r.value?"No audit data matches the current filters":"No audit data available yet"),1),i.value||r.value?(f(),y(p,{key:0,color:"primary",label:"Clear Filters",onClick:_,class:"q-mt-sm"})):h("",!0)])]),"body-cell-actions":d(l=>[s(I,{props:l},{default:d(()=>[s(p,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:C=>H(l.row.id)},null,8,["onClick"]),s(p,{flat:"",round:"",dense:"",color:"negative",icon:"delete",onClick:C=>D(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1}))}};export{ce as default};
