import{Q as N}from"./QPage-BoV4Bvqy.js";import{a as V,W as h,X as p,Y as o,_ as i,ac as P,a3 as s,a0 as y,a4 as A,a1 as w,$ as Q,ag as S,ab as R,a6 as k,a7 as _,H as L,U,aa as W,a5 as b}from"./index-BXwL6rGU.js";import{u as D}from"./survey-store-D25O1UXo.js";import{a as C,b as H,Q as E,d as j,c as B}from"./QTable-Dng6CFdi.js";import{u as I}from"./use-quasar-DHp_SMRG.js";import{Q as x}from"./QSkeleton-lFpvqK2i.js";import"./QList-Owok0XSe.js";import"./QSelect-ecL_iQXq.js";import"./QItem-oaxdh4Na.js";function q(c){setTimeout(()=>{window.URL.revokeObjectURL(c.href)},1e4),c.remove()}function M(c,r,a={}){const{mimeType:l,byteOrderMark:f,encoding:m}=typeof a=="string"?{mimeType:a}:a,n=m!==void 0?new TextEncoder(m).encode([r]):r,t=f!==void 0?[f,n]:[n],e=new Blob(t,{type:l||"application/octet-stream"}),u=document.createElement("a");u.href=window.URL.createObjectURL(e),u.setAttribute("download",c),typeof u.download>"u"&&u.setAttribute("target","_blank"),u.classList.add("hidden"),u.style.position="fixed",document.body.appendChild(u);try{return u.click(),q(u),!0}catch(d){return q(u),d}}const O={class:"text-subtitle2 q-mb-md"},z={class:"full-width row flex-center q-gutter-sm q-pa-lg"},F={class:"row items-center"},X={__name:"HighRiskPatientsByWard",props:{audits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},setup(c){const r=c,a=I(),l=V(()=>r.audits.length?[...new Set(r.audits.map(t=>t.ward))].map(t=>{const e=r.audits.filter(v=>v.ward===t),u=e.filter(v=>v.isHighRisk),d=e.length,g=u.length,$=d>0?Math.round(g/d*100):0,T=e.length>0?e[0].hospital:"";return{ward:t,hospital:T,totalPatients:d,highRiskPatients:g,percentage:$}}).sort((t,e)=>e.percentage-t.percentage):[]),f=()=>{const n=d=>{let g=d!=null?String(d):"";return g=g.replace(/"/g,'""'),(g.includes(",")||g.includes('"')||g.includes(`
`))&&(g=`"${g}"`),g};let e=m.map(d=>n(d.label)).join(",")+`
`;l.value.forEach(d=>{const g=[n(d.hospital),n(d.ward),n(d.totalPatients),n(d.highRiskPatients),n(d.percentage+"%")];e+=g.join(",")+`
`}),M("high_risk_patients_by_ward.csv",e,"text/csv")===!0?a.notify({color:"positive",message:"Ward statistics exported successfully",icon:"file_download"}):a.notify({color:"negative",message:"Export failed - browser denied file download",icon:"error"})},m=[{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"ward",required:!0,label:"Ward",align:"left",field:"ward",sortable:!0},{name:"totalPatients",label:"Total Patients",align:"center",field:"totalPatients",sortable:!0},{name:"highRiskPatients",label:"High Risk Patients",align:"center",field:"highRiskPatients",sortable:!0},{name:"percentage",label:"High Risk %",align:"center",field:"percentage",sortable:!0}];return(n,t)=>(p(),h(R,null,{default:o(()=>[i(P,null,{default:o(()=>[t[2]||(t[2]=s("div",{class:"text-h6"},"High Risk Patients by Ward",-1)),s("div",O,[t[0]||(t[0]=y(" Percentage of high risk patients in each ward ")),i(A,{color:"primary",icon:"file_download",label:"Export to CSV",class:"float-right",onClick:f,disable:!l.value.length||c.loading},null,8,["disable"])]),i(C,{title:"Ward Statistics",rows:l.value,columns:m,"row-key":"ward",loading:c.loading},{loading:o(()=>[i(B,{showing:""},{default:o(()=>[i(S,{size:"50px",color:"primary"})]),_:1})]),"no-data":o(()=>[s("div",z,[i(Q,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[1]||(t[1]=s("span",{class:"text-h6 text-grey-7"},"No ward data available",-1))])]),"body-cell-percentage":o(e=>[i(H,{props:e},{default:o(()=>[s("div",F,[i(E,{color:e.value>=70?"negative":e.value>=50?"warning":"positive",class:"q-mr-sm"},{default:o(()=>[y(w(e.value)+"% ",1)]),_:2},1032,["color"]),i(j,{value:e.value/100,color:e.value>=70?"negative":e.value>=50?"warning":"positive",style:{width:"100px"},class:"q-ml-sm"},null,8,["value","color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},Y={class:"row q-mt-md"},G={class:"col-12 col-md-4"},J={class:"text-h5"},K={class:"col-12 col-md-4"},Z={class:"text-h5"},tt={class:"col-12 col-md-4"},et={class:"text-h5"},at={__name:"HighRiskSummaryCard",props:{stats:{type:Object,required:!0,default:()=>({totalAudits:0,highRiskCount:0,highRiskPercentage:0})},loading:{type:Boolean,default:!1}},setup(c){const r=c;return(a,l)=>(p(),h(R,null,{default:o(()=>[i(P,null,{default:o(()=>[l[3]||(l[3]=s("div",{class:"text-h6"},"Summary",-1)),s("div",Y,[s("div",G,[l[0]||(l[0]=s("div",{class:"text-subtitle2"},"Total Patients",-1)),s("div",J,[r.loading?(p(),h(x,{key:0,type:"text",width:"50px"})):(p(),k(_,{key:1},[y(w(r.stats.totalAudits),1)],64))])]),s("div",K,[l[1]||(l[1]=s("div",{class:"text-subtitle2"},"High Risk Patients",-1)),s("div",Z,[r.loading?(p(),h(x,{key:0,type:"text",width:"50px"})):(p(),k(_,{key:1},[y(w(r.stats.highRiskCount),1)],64))])]),s("div",tt,[l[2]||(l[2]=s("div",{class:"text-subtitle2"},"Percentage",-1)),s("div",et,[r.loading?(p(),h(x,{key:0,type:"text",width:"50px"})):(p(),k(_,{key:1},[y(w(r.stats.highRiskPercentage)+"%",1)],64))])])])]),_:1})]),_:1}))}},st={class:"full-width row flex-center q-gutter-sm q-pa-lg"},it={__name:"PatientsOnFivePlusMedications",props:{highRiskAudits:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["view-audit"],setup(c,{emit:r}){const a=c,l=r,f=n=>{l("view-audit",n)},m=[{name:"auditDate",required:!0,label:"Date",align:"left",field:n=>n.auditDate,format:n=>`${n}`,sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"collectorName",label:"Audited By",align:"left",field:"collectorName",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];return(n,t)=>(p(),h(R,null,{default:o(()=>[i(P,null,{default:o(()=>[t[1]||(t[1]=s("div",{class:"text-h6"},"Patients on 5+ Medications",-1)),t[2]||(t[2]=s("div",{class:"text-subtitle2 q-mb-md"}," Patients taking 5 or more regular medications are considered high risk ",-1)),i(C,{title:"High Risk Patients",rows:a.highRiskAudits,columns:m,"row-key":"id",loading:a.loading},{loading:o(()=>[i(B,{showing:""},{default:o(()=>[i(S,{size:"50px",color:"primary"})]),_:1})]),"no-data":o(()=>[s("div",st,[i(Q,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[0]||(t[0]=s("span",{class:"text-h6 text-grey-7"}," No high risk patients found ",-1))])]),"body-cell-actions":o(e=>[i(H,{props:e},{default:o(()=>[i(A,{flat:"",round:"",dense:"",color:"primary",icon:"visibility",onClick:u=>f(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}},pt={__name:"HighRiskPage",setup(c){const r=W(),a=D();L(async()=>{await Promise.all([a.fetchAudits(),a.fetchHighRiskAudits(),a.fetchStats()])}),U(()=>{a.unsubscribeFromRealtimeUpdates()});const l=f=>{r.push(`/surveys/${f}`)};return(f,m)=>(p(),h(N,{padding:""},{default:o(()=>[m[0]||(m[0]=s("div",{class:"text-h4 text-primary q-mb-md"},"High Risk Patients",-1)),i(it,{"high-risk-audits":b(a).highRiskAudits,loading:b(a).loading,onViewAudit:l},null,8,["high-risk-audits","loading"]),i(at,{class:"q-mt-md",stats:b(a).stats,loading:b(a).loading},null,8,["stats","loading"]),i(X,{class:"q-mt-md",audits:b(a).audits,loading:b(a).loading},null,8,["audits","loading"])]),_:1}))}};export{pt as default};
