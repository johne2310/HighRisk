import{f as n,_ as S,c as E,o as i,w as d,u as b,al as V,a as o,Q as k,j as f,k as p,a3 as v,a0 as w,l as _,n as Q,a2 as h}from"./index-Cit6dkEs.js";import{Q as I}from"./QForm-CpNB1JBV.js";import{Q as N}from"./QPage-Db4V3SIo.js";import{useAuthStore as x}from"./auth-store-D-tjXtlA.js";import{u as A}from"./use-quasar-BgXlxNo6.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Bisc4Zw_.js";const U={key:0,class:"text-red"},D={key:1,class:"text-green"},q={__name:"ChangePasswordPage",setup(B){const l=n(""),c=n(""),r=n(!1),t=n(null),u=n(null),P=b(),y=V(),g=x(),m=A();S(()=>{console.log("Change Password Page"),g.supabase.auth.onAuthStateChange(a=>{a==="SIGNED_IN"?console.log("Signed in"):a==="SIGNED_OUT"?console.log("Signed out"):a==="PASSWORD_RECOVERY"?console.log("Password recovery"):a==="EMAIL_VERIFICATION"?console.log("Email verification"):a==="USER_UPDATED"&&console.log("User updated")})});const C=async()=>{r.value=!0,t.value=null,u.value=null,console.log("New Password: ",l.value);const a=y.query.access_token;try{a&&console.log("Access token: ",a);const{error:e}=await g.supabase.auth.updateUser({password:l.value});if(e)throw new Error(e.message);u.value="Password changed successfully! Redirecting to login...",m.notify({color:"positive",message:u.value,icon:"check_circle"}),setTimeout(()=>{P.push("/dashboard")},2e3)}catch(e){t.value=e.message||"An unexpected error occurred.",m.notify({color:"negative",message:t.value,icon:"warning"})}finally{r.value=!1}};return(a,e)=>(i(),E(N,{class:"reset-password",padding:""},{default:d(()=>[o(k,null,{default:d(()=>[o(f,null,{default:d(()=>e[2]||(e[2]=[p("div",{class:"text-h5"},"Change Password",-1)])),_:1}),o(f,null,{default:d(()=>[o(I,{onSubmit:C,class:"q-gutter-md"},{default:d(()=>[o(_,{filled:"",type:"password",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),label:"New Password","lazy-rules":"",rules:[s=>!!s||"Field is required",s=>s.length>=6||"Use at least 6 characters"]},null,8,["modelValue","rules"]),o(_,{filled:"",type:"password",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),label:"Confirm Password","lazy-rules":"",rules:[s=>!!s||"Field is required",s=>s===l.value||"Passwords do not match"]},null,8,["modelValue","rules"]),p("div",null,[o(Q,{color:"primary",type:"submit",label:r.value?"Loading...":"Change Password",loading:r.value,disable:r.value},null,8,["label","loading","disable"])]),t.value?(i(),v("div",U,h(t.value),1)):w("",!0),u.value?(i(),v("div",D,h(u.value),1)):w("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}},j=R(q,[["__scopeId","data-v-282f6832"]]);export{j as default};
