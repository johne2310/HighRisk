import{a as B,H as C,W as d,X as r,Y as s,aa as D,a3 as e,_ as a,ab as f,ac as p,a5 as o,a4 as I,$ as x,ag as y,a6 as h,a7 as b,a0 as u,a1 as g}from"./index-Dt_YxRgl.js";import{a as P,b as _,c as R,Q as T,d as W}from"./QTable-DcNtiF-0.js";import{Q as v}from"./QSkeleton-B15Fo3q0.js";import{Q as z}from"./QPage-CaFvhTdk.js";import{u as $}from"./survey-store-BP5nlAMi.js";import"./QList-mjBox0ww.js";import"./QSelect-BozJnXhA.js";import"./QItem-CPPvoI9R.js";import"./index-Bff8kiXL.js";const M={class:"full-width row flex-center q-gutter-sm q-pa-lg"},V={class:"row q-mt-md"},L={class:"col-12 col-md-4"},E={class:"text-h5"},F={class:"col-12 col-md-4"},X={class:"text-h5"},Y={class:"col-12 col-md-4"},j={class:"text-h5"},G={class:"full-width row flex-center q-gutter-sm q-pa-lg"},J={class:"row items-center"},ot={__name:"HighRiskPage",setup(K){const q=D(),i=$(),Q=B(()=>i.audits.length?[...new Set(i.audits.map(t=>t.ward))].map(t=>{const l=i.audits.filter(c=>c.ward===t),w=l.filter(c=>c.isHighRisk),m=l.length,k=w.length,N=m>0?Math.round(k/m*100):0;return{ward:t,totalPatients:m,highRiskPatients:k,percentage:N}}).sort((t,l)=>l.percentage-t.percentage):[]);C(async()=>{await Promise.all([i.fetchAudits(),i.fetchHighRiskAudits(),i.fetchStats()])});const H=n=>{q.push(`/surveys/${n}`)},S=[{name:"auditDate",required:!0,label:"Date",align:"left",field:n=>n.auditDate,format:n=>`${n}`,sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"collectorName",label:"Audited By",align:"left",field:"collectorName",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}],A=[{name:"ward",required:!0,label:"Ward",align:"left",field:"ward",sortable:!0},{name:"totalPatients",label:"Total Patients",align:"center",field:"totalPatients",sortable:!0},{name:"highRiskPatients",label:"High Risk Patients",align:"center",field:"highRiskPatients",sortable:!0},{name:"percentage",label:"High Risk %",align:"center",field:"percentage",sortable:!0}];return(n,t)=>(r(),d(z,{padding:""},{default:s(()=>[t[10]||(t[10]=e("div",{class:"text-h4 text-primary q-mb-md"},"High Risk Patients",-1)),a(f,null,{default:s(()=>[a(p,null,{default:s(()=>[t[1]||(t[1]=e("div",{class:"text-h6"},"Patients on 5+ Medications",-1)),t[2]||(t[2]=e("div",{class:"text-subtitle2 q-mb-md"}," Patients taking 5 or more regular medications are considered high risk ",-1)),a(P,{title:"High Risk Patients",rows:o(i).highRiskAudits,columns:S,"row-key":"id",loading:o(i).loading},{loading:s(()=>[a(R,{showing:""},{default:s(()=>[a(y,{size:"50px",color:"primary"})]),_:1})]),"no-data":s(()=>[e("div",M,[a(x,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[0]||(t[0]=e("span",{class:"text-h6 text-grey-7"}," No high risk patients found ",-1))])]),"body-cell-actions":s(l=>[a(_,{props:l},{default:s(()=>[a(I,{flat:"",round:"",dense:"",color:"primary",icon:"visibility",onClick:w=>H(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}),a(f,{class:"q-mt-md"},{default:s(()=>[a(p,null,{default:s(()=>[t[6]||(t[6]=e("div",{class:"text-h6"},"Summary",-1)),e("div",V,[e("div",L,[t[3]||(t[3]=e("div",{class:"text-subtitle2"},"Total Patients",-1)),e("div",E,[o(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(g(o(i).stats.totalAudits),1)],64))])]),e("div",F,[t[4]||(t[4]=e("div",{class:"text-subtitle2"},"High Risk Patients",-1)),e("div",X,[o(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(g(o(i).stats.highRiskCount),1)],64))])]),e("div",Y,[t[5]||(t[5]=e("div",{class:"text-subtitle2"},"Percentage",-1)),e("div",j,[o(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(g(o(i).stats.highRiskPercentage)+"%",1)],64))])])])]),_:1})]),_:1}),a(f,{class:"q-mt-md"},{default:s(()=>[a(p,null,{default:s(()=>[t[8]||(t[8]=e("div",{class:"text-h6"},"High Risk Patients by Ward",-1)),t[9]||(t[9]=e("div",{class:"text-subtitle2 q-mb-md"}," Percentage of high risk patients in each ward ",-1)),a(P,{title:"Ward Statistics",rows:Q.value,columns:A,"row-key":"ward",loading:o(i).loading},{loading:s(()=>[a(R,{showing:""},{default:s(()=>[a(y,{size:"50px",color:"primary"})]),_:1})]),"no-data":s(()=>[e("div",G,[a(x,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[7]||(t[7]=e("span",{class:"text-h6 text-grey-7"},"No ward data available",-1))])]),"body-cell-percentage":s(l=>[a(_,{props:l},{default:s(()=>[e("div",J,[a(T,{color:l.value>=70?"negative":l.value>=50?"warning":"positive",class:"q-mr-sm"},{default:s(()=>[u(g(l.value)+"% ",1)]),_:2},1032,["color"]),a(W,{value:l.value/100,color:l.value>=70?"negative":l.value>=50?"warning":"positive",style:{width:"100px"},class:"q-ml-sm"},null,8,["value","color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1}))}};export{ot as default};
