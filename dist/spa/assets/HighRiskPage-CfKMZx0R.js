import{a as B,H as C,U as D,W as d,X as r,Y as s,aa as I,a3 as e,_ as a,ab as f,ac as p,a5 as n,a4 as T,$ as x,ag as y,a6 as h,a7 as b,a0 as u,a1 as m}from"./index-N9zSqAvf.js";import{a as P,b as _,c as R,Q as W,d as z}from"./QTable-B73rID-7.js";import{Q as v}from"./QSkeleton-BUwLV0sM.js";import{Q as $}from"./QPage-CMDF2nR4.js";import{u as M}from"./survey-store-UR6lhz9Y.js";import"./QList-DtlVbaUZ.js";import"./QSelect-BYUnVaaT.js";import"./QItem-D-vW6HaK.js";const U={class:"full-width row flex-center q-gutter-sm q-pa-lg"},V={class:"row q-mt-md"},F={class:"col-12 col-md-4"},L={class:"text-h5"},E={class:"col-12 col-md-4"},X={class:"text-h5"},Y={class:"col-12 col-md-4"},j={class:"text-h5"},G={class:"full-width row flex-center q-gutter-sm q-pa-lg"},J={class:"row items-center"},nt={__name:"HighRiskPage",setup(K){const q=I(),i=M(),Q=B(()=>i.audits.length?[...new Set(i.audits.map(t=>t.ward))].map(t=>{const l=i.audits.filter(g=>g.ward===t),w=l.filter(g=>g.isHighRisk),c=l.length,k=w.length,N=c>0?Math.round(k/c*100):0;return{ward:t,totalPatients:c,highRiskPatients:k,percentage:N}}).sort((t,l)=>l.percentage-t.percentage):[]);C(async()=>{await Promise.all([i.fetchAudits(),i.fetchHighRiskAudits(),i.fetchStats()])}),D(()=>{i.unsubscribeFromRealtimeUpdates()});const H=o=>{q.push(`/surveys/${o}`)},S=[{name:"auditDate",required:!0,label:"Date",align:"left",field:o=>o.auditDate,format:o=>`${o}`,sortable:!0},{name:"patientId",required:!0,label:"Patient ID",align:"left",field:"patientId",sortable:!0},{name:"bedNumber",label:"Bed",align:"left",field:"bedNumber",sortable:!0},{name:"ward",label:"Ward",align:"left",field:"ward",sortable:!0},{name:"hospital",label:"Hospital",align:"left",field:"hospital",sortable:!0},{name:"collectorName",label:"Audited By",align:"left",field:"collectorName",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}],A=[{name:"ward",required:!0,label:"Ward",align:"left",field:"ward",sortable:!0},{name:"totalPatients",label:"Total Patients",align:"center",field:"totalPatients",sortable:!0},{name:"highRiskPatients",label:"High Risk Patients",align:"center",field:"highRiskPatients",sortable:!0},{name:"percentage",label:"High Risk %",align:"center",field:"percentage",sortable:!0}];return(o,t)=>(r(),d($,{padding:""},{default:s(()=>[t[10]||(t[10]=e("div",{class:"text-h4 text-primary q-mb-md"},"High Risk Patients",-1)),a(f,null,{default:s(()=>[a(p,null,{default:s(()=>[t[1]||(t[1]=e("div",{class:"text-h6"},"Patients on 5+ Medications",-1)),t[2]||(t[2]=e("div",{class:"text-subtitle2 q-mb-md"}," Patients taking 5 or more regular medications are considered high risk ",-1)),a(P,{title:"High Risk Patients",rows:n(i).highRiskAudits,columns:S,"row-key":"id",loading:n(i).loading},{loading:s(()=>[a(R,{showing:""},{default:s(()=>[a(y,{size:"50px",color:"primary"})]),_:1})]),"no-data":s(()=>[e("div",U,[a(x,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[0]||(t[0]=e("span",{class:"text-h6 text-grey-7"}," No high risk patients found ",-1))])]),"body-cell-actions":s(l=>[a(_,{props:l},{default:s(()=>[a(T,{flat:"",round:"",dense:"",color:"primary",icon:"visibility",onClick:w=>H(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}),a(f,{class:"q-mt-md"},{default:s(()=>[a(p,null,{default:s(()=>[t[6]||(t[6]=e("div",{class:"text-h6"},"Summary",-1)),e("div",V,[e("div",F,[t[3]||(t[3]=e("div",{class:"text-subtitle2"},"Total Patients",-1)),e("div",L,[n(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(m(n(i).stats.totalAudits),1)],64))])]),e("div",E,[t[4]||(t[4]=e("div",{class:"text-subtitle2"},"High Risk Patients",-1)),e("div",X,[n(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(m(n(i).stats.highRiskCount),1)],64))])]),e("div",Y,[t[5]||(t[5]=e("div",{class:"text-subtitle2"},"Percentage",-1)),e("div",j,[n(i).loading?(r(),d(v,{key:0,type:"text",width:"50px"})):(r(),h(b,{key:1},[u(m(n(i).stats.highRiskPercentage)+"%",1)],64))])])])]),_:1})]),_:1}),a(f,{class:"q-mt-md"},{default:s(()=>[a(p,null,{default:s(()=>[t[8]||(t[8]=e("div",{class:"text-h6"},"High Risk Patients by Ward",-1)),t[9]||(t[9]=e("div",{class:"text-subtitle2 q-mb-md"}," Percentage of high risk patients in each ward ",-1)),a(P,{title:"Ward Statistics",rows:Q.value,columns:A,"row-key":"ward",loading:n(i).loading},{loading:s(()=>[a(R,{showing:""},{default:s(()=>[a(y,{size:"50px",color:"primary"})]),_:1})]),"no-data":s(()=>[e("div",G,[a(x,{name:"sentiment_dissatisfied",size:"2rem",color:"grey-7"}),t[7]||(t[7]=e("span",{class:"text-h6 text-grey-7"},"No ward data available",-1))])]),"body-cell-percentage":s(l=>[a(_,{props:l},{default:s(()=>[e("div",J,[a(W,{color:l.value>=70?"negative":l.value>=50?"warning":"positive",class:"q-mr-sm"},{default:s(()=>[u(m(l.value)+"% ",1)]),_:2},1032,["color"]),a(z,{value:l.value/100,color:l.value>=70?"negative":l.value>=50?"warning":"positive",style:{width:"100px"},class:"q-ml-sm"},null,8,["value","color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1}))}};export{nt as default};
